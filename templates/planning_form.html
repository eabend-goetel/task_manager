{% extends 'base.html' %}
{% block content %}
<h1>Planung</h1>
<form method="post">
  <div class="mb-3">
    <label class="form-label">Aufgabe</label>
    <select class="form-select" name="task">
      {% for t in tasks %}
      <option value="{{ t.id }}">{{ t.project }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">Bearbeiter</label>
    <select class="form-select" name="worker">
      {% for w in workers %}
      <option value="{{ w.id }}">{{ w.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">Jahr</label>
    <select class="form-select" name="year" id="yearSelect">
      {% for y in years %}
      <option value="{{ y.year }}">{{ y.year }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">KW</label>
    <select class="form-select" name="week" id="weekSelect"></select>
  </div>
  <div class="mb-3">
    <label class="form-label">Stunden</label>
    <input type="number" step="0.1" class="form-control" name="hours" required>
  </div>
  <button class="btn btn-primary"><i class="bi bi-save"></i> Speichern</button>
</form>
<script>
async function loadWeeks() {
  const year = document.getElementById('yearSelect').value;
  const resp = await fetch('{{ url_for('weeks', year=0) }}'.replace('0', year));
  const data = await resp.json();
  const select = document.getElementById('weekSelect');
  select.innerHTML = '';
  data.forEach(w => {
    const opt = document.createElement('option');
    opt.value = w.week;
    opt.textContent = w.label;
    select.appendChild(opt);
  });
}
document.getElementById('yearSelect').addEventListener('change', loadWeeks);
document.addEventListener('DOMContentLoaded', loadWeeks);
</script>
{% endblock %}
